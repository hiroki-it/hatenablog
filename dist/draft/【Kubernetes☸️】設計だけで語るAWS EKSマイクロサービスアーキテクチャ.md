---
Title: 【Kubernetes☸️】AWS EKSとCNCF OSSでマイクロサービスアーキテクチャを支えるインフラ設計プラクティス
Category:
  - AWS
  - Kubernetes
  - ソフトウェアアーキテクチャ
---

<br>

# この記事から得られる知識

この記事を読むと、以下を **"完全に理解"** できます✌️

<br>

[:contents]

<br>

# 01. はじめに

<br>

どうも、地下強制労働者です。

普段は、マイクロサービスアーキテクチャのプロダクトに携わっています。

マイクロサービスアーキテクチャの実例を探してみると、何かのコンポーネントをフルスクラッチで実装している例をよく見かけます。

ただ、フルスクラッチで実装したものは保守運用が大変になりがちなので、できるだけマネージドサービスやOSSで代替したいところです。

そこで、マネージドサービス (今回はAWS) とOSSをどのように組み合わせると、マイクロサービスアーキテクチャを設計できそうかを考えてみました。

動かせるサンプル実装を用意できていないので、『実際にやってみたけど、それ無理やったで』だったとしても大目にみてもらえると嬉しいです

それでは、もりもり布教していきます😗

<br>

# 02. 題材にするマイクロサービスアーキテクチャ

## AWSアーキテクチャ

アーキテクチャは以下の通りです。

AWSリソースで代替しても不都合のない機能は、AWSリソースを使うことを想定しています。

## アプリ領域の設計

AWS ALBとIstio IngressGatewayを繋ぐ時に、AWS Load Balancer Controllerを使用してもいいですが、なくても良いと考えています。

Istio IngressGatewayにNodePort Serviceを使用すれば、AWS Load Balancer Controllerが不要になります。

Istio IngressGatewayはKubernetesで、ALBはTerraformで管理します。

<br>

## インフラ領域の設計

<br>

<br>

# 03. AWS EKS以外の選択肢

ここまで、マイクロサービスアーキテクチャをAWS EKSで動かす例を解説しました。

ここでは、他のAWSリソースの選択肢と、マイクロサービスアーキテクチャとの相性を考えようと思います。

あくまで僕の宗派ですので、以下のAWSリソースでマイクロサービスアーキテクチャを作るべきだという方もいると思います。

### AWS ECS

AWS ECSを使用して、マイクロサービスアーキテクチャを動かします。

この場合、マイクロサービスをAWS ECSサービスに対応させ、AWS ECSタスクでマイクロサービスをスケーリングすることになります。

また、マイクロサービス間の通信はリクエストリプライ方式になります。

AWS ECSは、AWS EKSよりもアプリ領域とインフラ領域の責務がより曖昧になります。

アプリ領域とインフラ領域が分業が進んでいない組織では、責務の境界が曖昧でも問題は起こりにくいです。

その一方で、組織が大きくなるほどAWS ECSの管理者がボトルネックになります。

例えば、AWS ECSを管理しているのがインフラチームだとして、ただアプリチームのコンテナの設定はAWS ECSに反映しないといけないです。

この時、インフラチームに依頼することになるのですが、インフラチームが手一杯であれば、スピード感が落ちます。

システムの将来的な拡張性を想定してマイクロサービスアーキテクチャを採用したはずなのに、これでは本末転倒かなと思います。

ただ、AWS EKSに至るまでの中継地点として、AWS ECSを採用することはアリと考えています。

<br>

### AWS Lambda

AWS Lambdaを使用して、マイクロサービスアーキテクチャを動かします。

この場合、マイクロサービスをAWS Lambdaに対応させることになります。

また、マイクロサービス間の通信はイベント駆動方式になります。

AWS Lambdaは、AWS EKSやAWS ECSよりもさらにアプリ領域とインフラ領域の責務がより曖昧になります。

組織が大きくなるほどAWS Lambdaの管理者がボトルネックになり、AWS ECSよりも拡張性の問題は顕著です。

また、イベント駆動方式とリクエストリプライ方式はドメインのモデリング方法が大きくことなります。

そのため、AWS EKSやAWS ECSに至るまでの中継地点としても採用する場合、イベント駆動方式を採用し続けることになります。

これらのことから、AWS Lambdaでマイクロサービスアーキテクチャを採用するべきではないと考えています。

<br>
